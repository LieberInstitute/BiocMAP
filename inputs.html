<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Inputs | BiocMAP</title>
  <meta name="description" content="6 Inputs | BiocMAP" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Inputs | BiocMAP" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Inputs | BiocMAP" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="annotation.html"/>
<link rel="next" href="outputs.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a>
<ul>
<li><a href="index.html#cite-biocmap">Cite <code>BiocMAP</code></a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#r-session-information"><i class="fa fa-check"></i>R session information</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="quick-start.html"><a href="quick-start.html"><i class="fa fa-check"></i><b>1</b> Quick Start</a>
<ul>
<li class="chapter" data-level="1.1" data-path="quick-start.html"><a href="quick-start.html#setup"><i class="fa fa-check"></i><b>1.1</b> Setup</a></li>
<li class="chapter" data-level="1.2" data-path="quick-start.html"><a href="quick-start.html#quick-config"><i class="fa fa-check"></i><b>1.2</b> Configuration</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="quick-start.html"><a href="quick-start.html#your-main-script"><i class="fa fa-check"></i><b>1.2.1</b> Your “main” script</a></li>
<li class="chapter" data-level="1.2.2" data-path="quick-start.html"><a href="quick-start.html#your-config-file"><i class="fa fa-check"></i><b>1.2.2</b> Your config file</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="setup-details.html"><a href="setup-details.html"><i class="fa fa-check"></i><b>2</b> Setup Details</a>
<ul>
<li class="chapter" data-level="2.1" data-path="setup-details.html"><a href="setup-details.html#requirements"><i class="fa fa-check"></i><b>2.1</b> Requirements</a></li>
<li class="chapter" data-level="2.2" data-path="setup-details.html"><a href="setup-details.html#installation"><i class="fa fa-check"></i><b>2.2</b> Installation</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="setup-details.html"><a href="setup-details.html#troubleshooting"><i class="fa fa-check"></i><b>2.2.1</b> Troubleshooting</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="setup-details.html"><a href="setup-details.html#run-the-pipeline"><i class="fa fa-check"></i><b>2.3</b> Run the Pipeline</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="setup-details.html"><a href="setup-details.html#run-in-a-slurm-environment-cluster"><i class="fa fa-check"></i><b>2.3.1</b> Run in a SLURM environment/ cluster</a></li>
<li class="chapter" data-level="2.3.2" data-path="setup-details.html"><a href="setup-details.html#run-on-a-sun-grid-engines-sge-cluster"><i class="fa fa-check"></i><b>2.3.2</b> Run on a Sun Grid Engines (SGE) cluster</a></li>
<li class="chapter" data-level="2.3.3" data-path="setup-details.html"><a href="setup-details.html#run-locally"><i class="fa fa-check"></i><b>2.3.3</b> Run locally</a></li>
<li class="chapter" data-level="2.3.4" data-path="setup-details.html"><a href="setup-details.html#run-on-the-jhpce-cluster"><i class="fa fa-check"></i><b>2.3.4</b> Run on the <span>JHPCE</span> cluster</a></li>
<li class="chapter" data-level="2.3.5" data-path="setup-details.html"><a href="setup-details.html#example-main-script"><i class="fa fa-check"></i><b>2.3.5</b> Example main script</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="setup-details.html"><a href="setup-details.html#sharing"><i class="fa fa-check"></i><b>2.4</b> Sharing the pipeline with many users</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="setup-details.html"><a href="setup-details.html#customizing-execution-for-each-user"><i class="fa fa-check"></i><b>2.4.1</b> Customizing execution for each user</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="command-opts.html"><a href="command-opts.html"><i class="fa fa-check"></i><b>3</b> All Command Options</a>
<ul>
<li class="chapter" data-level="3.1" data-path="command-opts.html"><a href="command-opts.html#biocmap-options"><i class="fa fa-check"></i><b>3.1</b> BiocMAP Options</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="command-opts.html"><a href="command-opts.html#mandatory-parameters"><i class="fa fa-check"></i><b>3.1.1</b> Mandatory Parameters</a></li>
<li class="chapter" data-level="3.1.2" data-path="command-opts.html"><a href="command-opts.html#optional-parameters"><i class="fa fa-check"></i><b>3.1.2</b> Optional Parameters</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="command-opts.html"><a href="command-opts.html#next-opts"><i class="fa fa-check"></i><b>3.2</b> Nextflow Options</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="pipeline-overview.html"><a href="pipeline-overview.html"><i class="fa fa-check"></i><b>4</b> Pipeline Overview</a>
<ul>
<li class="chapter" data-level="4.1" data-path="pipeline-overview.html"><a href="pipeline-overview.html#preparation-steps"><i class="fa fa-check"></i><b>4.1</b> Preparation Steps</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="pipeline-overview.html"><a href="pipeline-overview.html#downloading-and-preparing-required-annotation-files"><i class="fa fa-check"></i><b>4.1.1</b> Downloading and preparing required annotation files</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="pipeline-overview.html"><a href="pipeline-overview.html#main-workflow-steps-first-module"><i class="fa fa-check"></i><b>4.2</b> Main Workflow Steps: First Module</a></li>
<li class="chapter" data-level="4.3" data-path="pipeline-overview.html"><a href="pipeline-overview.html#main-workflow-steps-second-module"><i class="fa fa-check"></i><b>4.3</b> Main Workflow Steps: Second Module</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="annotation.html"><a href="annotation.html"><i class="fa fa-check"></i><b>5</b> Annotation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="annotation.html"><a href="annotation.html#default-annotation"><i class="fa fa-check"></i><b>5.1</b> Default Annotation</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="annotation.html"><a href="annotation.html#choosing-a-release"><i class="fa fa-check"></i><b>5.1.1</b> Choosing a release</a></li>
<li class="chapter" data-level="5.1.2" data-path="annotation.html"><a href="annotation.html#choosing-build"><i class="fa fa-check"></i><b>5.1.2</b> Choosing a “build”</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="annotation.html"><a href="annotation.html#custom-annotation"><i class="fa fa-check"></i><b>5.2</b> Custom Annotation</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="inputs.html"><a href="inputs.html"><i class="fa fa-check"></i><b>6</b> Inputs</a>
<ul>
<li class="chapter" data-level="6.1" data-path="inputs.html"><a href="inputs.html#the-samples.manifest-file"><i class="fa fa-check"></i><b>6.1</b> The <code>samples.manifest</code> File</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="inputs.html"><a href="inputs.html#what-samples.manifest-should-look-like"><i class="fa fa-check"></i><b>6.1.1</b> What <code>samples.manifest</code> should look like</a></li>
<li class="chapter" data-level="6.1.2" data-path="inputs.html"><a href="inputs.html#more-details-regarding-inputs"><i class="fa fa-check"></i><b>6.1.2</b> More details regarding inputs</a></li>
<li class="chapter" data-level="6.1.3" data-path="inputs.html"><a href="inputs.html#creating-a-manifest-file"><i class="fa fa-check"></i><b>6.1.3</b> Creating a manifest file</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="inputs.html"><a href="inputs.html#the-rules.txt-file"><i class="fa fa-check"></i><b>6.2</b> The <code>rules.txt</code> File</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="inputs.html"><a href="inputs.html#what-rules.txt-should-look-like"><i class="fa fa-check"></i><b>6.2.1</b> What <code>rules.txt</code> should look like</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="outputs.html"><a href="outputs.html"><i class="fa fa-check"></i><b>7</b> Outputs</a>
<ul>
<li class="chapter" data-level="7.1" data-path="outputs.html"><a href="outputs.html#main-outputs"><i class="fa fa-check"></i><b>7.1</b> Main Outputs</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="outputs.html"><a href="outputs.html#cpg-bsseq-object"><i class="fa fa-check"></i><b>7.1.1</b> CpG <em>bsseq</em> object</a></li>
<li class="chapter" data-level="7.1.2" data-path="outputs.html"><a href="outputs.html#cph-bsseq-object"><i class="fa fa-check"></i><b>7.1.2</b> CpH <em>bsseq</em> object</a></li>
<li class="chapter" data-level="7.1.3" data-path="outputs.html"><a href="outputs.html#storage-method"><i class="fa fa-check"></i><b>7.1.3</b> Storage method</a></li>
<li class="chapter" data-level="7.1.4" data-path="outputs.html"><a href="outputs.html#metrics"><i class="fa fa-check"></i><b>7.1.4</b> Metrics</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="outputs.html"><a href="outputs.html#intermediary-outputs"><i class="fa fa-check"></i><b>7.2</b> Intermediary Outputs</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="outputs.html"><a href="outputs.html#first-module"><i class="fa fa-check"></i><b>7.2.1</b> First Module</a></li>
<li class="chapter" data-level="7.2.2" data-path="outputs.html"><a href="outputs.html#second-module"><i class="fa fa-check"></i><b>7.2.2</b> Second Module</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="configuration.html"><a href="configuration.html"><i class="fa fa-check"></i><b>8</b> Configuration</a>
<ul>
<li class="chapter" data-level="8.1" data-path="configuration.html"><a href="configuration.html#specifying-options-for-your-cluster"><i class="fa fa-check"></i><b>8.1</b> Specifying Options for your Cluster</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="configuration.html"><a href="configuration.html#time"><i class="fa fa-check"></i><b>8.1.1</b> Time</a></li>
<li class="chapter" data-level="8.1.2" data-path="configuration.html"><a href="configuration.html#cluster-specific-options"><i class="fa fa-check"></i><b>8.1.2</b> Cluster-specific options</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="configuration.html"><a href="configuration.html#biocmap-settings"><i class="fa fa-check"></i><b>8.2</b> BiocMAP settings</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="configuration.html"><a href="configuration.html#annotation-settings"><i class="fa fa-check"></i><b>8.2.1</b> Annotation settings</a></li>
<li class="chapter" data-level="8.2.2" data-path="configuration.html"><a href="configuration.html#arioc-settings"><i class="fa fa-check"></i><b>8.2.2</b> Arioc settings</a></li>
<li class="chapter" data-level="8.2.3" data-path="configuration.html"><a href="configuration.html#miscellaneous-settings"><i class="fa fa-check"></i><b>8.2.3</b> Miscellaneous settings</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="software.html"><a href="software.html"><i class="fa fa-check"></i><b>9</b> Software</a>
<ul>
<li class="chapter" data-level="9.1" data-path="software.html"><a href="software.html#software-versions"><i class="fa fa-check"></i><b>9.1</b> Software Versions</a></li>
<li class="chapter" data-level="9.2" data-path="software.html"><a href="software.html#docker-images"><i class="fa fa-check"></i><b>9.2</b> Docker Images</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="help.html"><a href="help.html"><i class="fa fa-check"></i><b>10</b> Help</a>
<ul>
<li class="chapter" data-level="10.1" data-path="help.html"><a href="help.html#common-errors"><i class="fa fa-check"></i><b>10.1</b> Common Errors</a></li>
<li class="chapter" data-level="10.2" data-path="help.html"><a href="help.html#resuming"><i class="fa fa-check"></i><b>10.2</b> Resuming</a></li>
<li class="chapter" data-level="10.3" data-path="help.html"><a href="help.html#docker-help"><i class="fa fa-check"></i><b>10.3</b> Docker help</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">BiocMAP</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="inputs" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Inputs</h1>
<p>The only input to the first module is a file called <code>samples.manifest</code>. This user-created file associates each FASTQ file with a path and ID, and allows the pipeline to automatically merge files if necessary. After creating the <code>samples.manifest</code> file, one must add the <code>--input</code> <a href="command-opts.html#command-opts">argument</a> to <a href="quick-start.html#quick-config">the approriate execution script for the first module</a>, and its value should be the path to the directory containing <code>samples.manifest</code>. For example, if the full path is <code>/users/neagles/samples.manifest</code>, the full argument in the execution script should be <code>--input "/users/neagles"</code>.</p>
<p>The second module requires the same <code>samples.manifest</code> file and an additional file called <code>rules.txt</code>. The latter specifies where relevant logs and the <code>samples.manifest</code> file are located. Similarly as in the first module, one must add the <code>--input</code> <a href="command-opts.html#command-opts">argument</a> to <a href="quick-start.html#quick-config">the approriate execution script for the second module</a>, but its value should be the path to the directory containing <code>rules.txt</code>.</p>
<div id="the-samples.manifest-file" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> The <code>samples.manifest</code> File</h2>
<div id="what-samples.manifest-should-look-like" class="section level3" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> What <code>samples.manifest</code> should look like</h3>
<p>Each line in <code>samples.manifest</code> should have the following format:</p>
<ul>
<li><em>For a set of unpaired reads</em> <code>&lt;PATH TO FASTQ FILE&gt;(tab)&lt;optional MD5&gt;(tab)&lt;sample label/id&gt;</code></li>
<li><em>For paired-end sets of reads</em> <code>&lt;PATH TO FASTQ 1&gt;(tab)&lt;optional MD5 1&gt;(tab)&lt;PATH TO FASTQ 2&gt;(tab)&lt;optional MD5 2&gt;(tab)&lt;sample label/id&gt;</code></li>
</ul>
<p>A line of paired-end reads could look like this:</p>
<p><code>WGBS_sample1_read1.fastq    0    WGBS_sample1_read2.fastq    0    sample1</code></p>
<ul>
<li>The MD5(s) on each line are for compatibility with a conventional samples.manifest structure, and are not explicitly checked in the pipeline (you may simply use 0s as in the above example).</li>
<li>Paths must be long/full.</li>
<li>If you have a single sample split across multiple files, you can signal for the pipeline to merge these files by repeating the sample label/id on each line of files to merge.</li>
<li>A <code>samples.manifest</code> file cannot include both single-end and paired-end reads; separate pipeline runs should be performed for each of these read types.</li>
</ul>
<p>This is an example of a <code>samples.manifest</code> file for some paired-end samples. Note how the first sample “dm3” is split across more than one pair of files, and is to be merged:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="inputs.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">/scratch/dm3_file1_1.fastq</span>  0   /scratch/dm3_file1_2.fastq  0   dm3</span>
<span id="cb16-2"><a href="inputs.html#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="ex">/scratch/dm3_file2_1.fastq</span>  0   /scratch/dm3_file2_2.fastq  0   dm3</span>
<span id="cb16-3"><a href="inputs.html#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="ex">/scratch/sample_01_1.fastq.gz</span>   0   /scratch/sample_01_2.fastq.gz   0   sample_01</span>
<span id="cb16-4"><a href="inputs.html#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="ex">/scratch/sample_02_1.fastq.gz</span>   0   /scratch/sample_02_2.fastq.gz   0   sample_02</span></code></pre></div>
</div>
<div id="more-details-regarding-inputs" class="section level3" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> More details regarding inputs</h3>
<ul>
<li>Input FASTQ files can have the following file extensions: <code>.fastq</code>, <code>.fq</code>, <code>.fastq.gz</code>, <code>.fq.gz</code></li>
<li>FASTQ files must not contain “.” characters before the typical extension (e.g. sample.1.fastq), since some internal functions rely on splitting file names by “.”.</li>
</ul>
</div>
<div id="creating-a-manifest-file" class="section level3" number="6.1.3">
<h3><span class="header-section-number">6.1.3</span> Creating a manifest file</h3>
<p>In a common scenario, you may have a large number of FASTQ files in a single directory, for a given experiment. How can the <code>samples.manifest</code> file be constructed in this case? While the method you use is a matter of preference, we find it straightforward to write a small R script to generate the manifest.</p>
<p>Suppose we have 3 paired-end samples, consisting of a total of 6 FASTQ files:</p>
<pre><code>/data/fastq/SAMPLE1_L001_R1_001.fastq.gz
/data/fastq/SAMPLE1_L001_R2_001.fastq.gz
/data/fastq/SAMPLE2_L002_R1_001.fastq.gz
/data/fastq/SAMPLE2_L002_R2_001.fastq.gz
/data/fastq/SAMPLE3_L003_R1_001.fastq.gz
/data/fastq/SAMPLE3_L003_R2_001.fastq.gz</code></pre>
<p>The following script can generate the manifest appropriate for this experiment:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="inputs.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  If needed, install the &#39;jaffelab&#39; GitHub-based package, which includes a</span></span>
<span id="cb18-2"><a href="inputs.html#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  useful function for string manipulation</span></span>
<span id="cb18-3"><a href="inputs.html#cb18-3" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;LieberInstitute/jaffelab&quot;</span>)</span>
<span id="cb18-4"><a href="inputs.html#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="inputs.html#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;jaffelab&quot;</span>)</span>
<span id="cb18-6"><a href="inputs.html#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="inputs.html#cb18-7" aria-hidden="true" tabindex="-1"></a>fastq_dir <span class="ot">&lt;-</span> <span class="st">&quot;/data/fastq&quot;</span></span>
<span id="cb18-8"><a href="inputs.html#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="inputs.html#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">#  We can take advantage of the uniform file naming convention to get the paths</span></span>
<span id="cb18-10"><a href="inputs.html#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co">#  of each mate in the pair, for every sample. Here we use a somewhat</span></span>
<span id="cb18-11"><a href="inputs.html#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co">#  complicated regular expression to match file names (to be sure we are</span></span>
<span id="cb18-12"><a href="inputs.html#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co">#  matching precisely the files we think we&#39;re matching), but this can be kept</span></span>
<span id="cb18-13"><a href="inputs.html#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co">#  simple if preferred.</span></span>
<span id="cb18-14"><a href="inputs.html#cb18-14" aria-hidden="true" tabindex="-1"></a>r1 <span class="ot">&lt;-</span> <span class="fu">list.files</span>(fastq_dir, <span class="st">&quot;.*_L00._R1_001</span><span class="sc">\\</span><span class="st">.fastq</span><span class="sc">\\</span><span class="st">.gz&quot;</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-15"><a href="inputs.html#cb18-15" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">&lt;-</span> <span class="fu">list.files</span>(fastq_dir, <span class="st">&quot;.*_L00._R2_001</span><span class="sc">\\</span><span class="st">.fastq</span><span class="sc">\\</span><span class="st">.gz&quot;</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-16"><a href="inputs.html#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="inputs.html#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co">#  We can form a unique ID for each sample by taking the portion of the path to</span></span>
<span id="cb18-18"><a href="inputs.html#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="co">#  the first read preceding the lane and mate identifiers. The function &#39;ss&#39; is</span></span>
<span id="cb18-19"><a href="inputs.html#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="co">#  a vectorized form of &#39;strsplit&#39;, handy for this task</span></span>
<span id="cb18-20"><a href="inputs.html#cb18-20" aria-hidden="true" tabindex="-1"></a>ids <span class="ot">&lt;-</span> <span class="fu">ss</span>(<span class="fu">basename</span>(r1), <span class="st">&quot;_L00&quot;</span>)</span>
<span id="cb18-21"><a href="inputs.html#cb18-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-22"><a href="inputs.html#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="co">#  Sanity check: there should be the same number of first reads as second reads</span></span>
<span id="cb18-23"><a href="inputs.html#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">length</span>(R1) <span class="sc">==</span> <span class="fu">length</span>(R2))</span>
<span id="cb18-24"><a href="inputs.html#cb18-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-25"><a href="inputs.html#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="co">#  Prepare the existing sample information into the expected format (for now,</span></span>
<span id="cb18-26"><a href="inputs.html#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="co">#  as a character vector where each element will be a line in</span></span>
<span id="cb18-27"><a href="inputs.html#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="co">#  &#39;samples.manifest&#39;). We will simply use zeros for the optional MD5 sums.</span></span>
<span id="cb18-28"><a href="inputs.html#cb18-28" aria-hidden="true" tabindex="-1"></a>manifest <span class="ot">&lt;-</span> <span class="fu">paste</span>(r1, <span class="dv">0</span>, r2, <span class="dv">0</span>, ids, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb18-29"><a href="inputs.html#cb18-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-30"><a href="inputs.html#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="co">#  Write the manifest to a file (in this case, in the current working</span></span>
<span id="cb18-31"><a href="inputs.html#cb18-31" aria-hidden="true" tabindex="-1"></a><span class="co">#  directory)</span></span>
<span id="cb18-32"><a href="inputs.html#cb18-32" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(manifest, <span class="at">con =</span> <span class="st">&quot;samples.manifest&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="the-rules.txt-file" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> The <code>rules.txt</code> File</h2>
<div id="what-rules.txt-should-look-like" class="section level3" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> What <code>rules.txt</code> should look like</h3>
<pre><code># An example &#39;rules.txt&#39; file
manifest = /users/nick/samples.manifest
sam = /users/nick/Arioc/[id]/sams/[id].cfu.sam
arioc_log = /users/nick/Arioc/[id]/log/AriocP.[id].log
xmc_log = /users/nick/Arioc/[id]/log/[id].cfu.XMC.log
trim_report = /users/nick/trim_galore/[id]/[id].fastq.gz_trimming_report.txt
fastqc_log_last = /users/nick/FastQC/[id]_trimmed_summary.txt
fastqc_log_first = /users/nick/FastQC/[id]_untrimmed_summary.txt</code></pre>
<ul>
<li>This file consists of several lines of key-value pairs, where keys and values are separated by an equals sign (“=”) and optionally spaces.</li>
<li>Lines without “=” are ignored, and can be used as comments. The above example starts such lines with “#” for clarity.</li>
<li>The required keys to include in a valid <code>rules.txt</code> file include “manifest”, “sam”, “arioc_log”, “trim_report”, and “fastqc_log_last”. The associated values for these keys are the paths to the <code>samples.manifest</code> file, the filtered/deduplicated alignment SAMs, verbose output logs from Arioc alignment, output logs from <code>TrimGalore!</code>, and logs from the latest or only run of FastQC (see the below point about optional keys), respectively. Note that users who plan to use MethylDackel for methylation extraction (the default!) should have coordinate-sorted and indexed BAM files ready, which are passed to the “sam” key using a glob expression. Otherwise, just one SAM file is expected per sample. Note this example for the former case:</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="inputs.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppose we have 4 files across 2 samples:</span></span>
<span id="cb20-2"><a href="inputs.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co">#    /users/nick/alignments/id1_sorted.bam and /users/nick/alignments/id1_sorted.bam.bai</span></span>
<span id="cb20-3"><a href="inputs.html#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">#    /users/nick/alignments/id2_sorted.bam and /users/nick/alignments/id2_sorted.bam.bai</span></span>
<span id="cb20-4"><a href="inputs.html#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We can point to these files using the &#39;sam&#39; key in &#39;rules.txt&#39;:</span></span>
<span id="cb20-5"><a href="inputs.html#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="ex">sam</span> = /users/nick/alignments/[id]_sorted.bam<span class="pp">*</span></span></code></pre></div>
<ul>
<li>Optional keys accepted in a <code>rules.txt</code> file include “xmc_log” and “fastqc_log_first”. Associated values are paths to logs from XMC (a utility that comes with the Arioc software), and <code>*summary.txt</code> logs from FastQC, respectively. The optional “fastqc_log_first” key can be used when the user runs FastQC twice (for example, before and after trimming) for at least one sample. In this case, “fastqc_log_first” refers to the pre-trimming run of FastQC. Typically, methylation extraction is done in the second module, and the “xmc_log” option is only included for compatibility with a previous WGBS processing approach. Information from these logs will be included in the R data frame output from the second module, if these logs are present and specified in <code>rules.txt</code>.</li>
<li>Since exact paths are different between samples, including “[id]” in the value field in a line of <code>rules.txt</code> indicates that the path for any particular sample can be found by replacing “[id]” with its sample ID. Otherwise, paths are interpreted literally.</li>
<li>For paired-end experiments, there will be two summary logs from FastQC. To correctly describe this in <code>rules.txt</code>, a glob expression may be used. As an example, suppose we have FastQC summary logs for a sample called <code>sample1</code>, given by the paths <code>/some_dir/fastqc/sample1_1_summary.txt</code> and <code>/some_dir/fastqc/sample1_2_summary.txt</code>. The following line in <code>rules.txt</code> would be appropriate:</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="inputs.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">fastqc_log_last</span> = /some_dir/fastqc/[id]_[12]_summary.txt</span></code></pre></div>
<p>Be careful with forming glob expressions! If we had a 10-sample experiment with sample names <code>sample1</code> through <code>sample10</code> but used a simpler asterisk “*” in place of the alternation “_[12]” in the above example, we would get an error!</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="inputs.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  This is wrong! When finding files for &quot;sample1&quot;, we&#39;d also match files for</span></span>
<span id="cb22-2"><a href="inputs.html#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  &quot;sample10&quot;!</span></span>
<span id="cb22-3"><a href="inputs.html#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="ex">fastqc_log_last</span> = /some_dir/fastqc/[id]<span class="pp">*</span>_summary.txt</span></code></pre></div>
<ul>
<li>The <code>--input [dir]</code> argument to the <code>nextflow</code> command in <code>run_second_half_*.sh</code> scripts specifies the directory containing the <code>rules.txt</code> file, and is a required argument.</li>
</ul>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="annotation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="outputs.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
